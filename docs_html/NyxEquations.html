

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Hydrodynamic Equations in Comoving Coordinates &mdash; Nyx 18.10
 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"kth": "{{k_\\mathrm{th}}}", "gcc": "{\\mathrm{g~cm^{-3}}}", "cms": "{\\mathrm{cm~s^{-1}}}", "presunit": "{\\mathrm{dyn~cm^{-2}}}", "accelunit": "{\\mathrm{cm~s^{-2}}}", "ergg": "{\\mathrm{erg~g^{-1}}}", "Ab": "{{\\bf A}}", "eb": "{{\\bf e}}", "Fb": "{{\\bf F}}", "gb": "{{\\bf g}}", "Hb": "{{\\bf H}}", "ib": "{{\\bf i}}", "Ib": "{{\\bf I}}", "Kb": "{{\\bf K}}", "lb": "{{\\bf l}}", "Lb": "{{\\bf L}}", "nb": "{{\\bf n}}", "Pb": "{{\\bf P}}", "Qb": "{{\\bf Q}}", "rb": "{{\\bf r}}", "Rb": "{{\\bf R}}", "Sb": "{{\\bf S}}", "ub": "{{\\bf u}}", "Ub": "{{\\bf U}}", "xb": "{{\\bf x}}", "dt": "{\\Delta t}", "omegadot": "{\\dot\\omega}", "inp": "{{\\rm in}}", "outp": "{{\\rm out}}", "sync": "{{\\rm sync}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\half}", "nph": "{{n+\\myhalf}}", "kpp": "{\\ensuremath{\\kappa_{\\mathrm{P}}}}", "kpr": "{\\ensuremath{\\kappa_{\\mathrm{R}}}}", "kpf": "{\\ensuremath{\\kappa_{\\mathrm{F}}}}", "vb": "{\\boldsymbol{v}}", "vbt": "{\\widetilde{\\vb}}", "rbt": "{\\widetilde{\\rb}}", "ob": "{\\boldsymbol{\\omega}}", "nablab": "{\\boldsymbol{\\nabla}}"}}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dark matter particles" href="Particles.html" />
    <link rel="prev" title="Gravity" href="NyxGravity.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Nyx
          

          
          </a>

          
            
            
              <div class="version">
                18.10

              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Nyx basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="NyxPreface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxIntroduction.html">Introduction to Nyx</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxGettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxGravity.html">Gravity</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hydrodynamic Equations in Comoving Coordinates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#conservative-form">Conservative Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tracing">Tracing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#subgrid-scale-model-in-comoving-coordinates">Subgrid Scale Model in Comoving Coordinates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Dark matter particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxHeatCool.html">Radiative Heating and Cooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="InputsMultigrid.html">Multigrid Inputs</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filelist.html">File list</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlist.html">Class list</a></li>
<li class="toctree-l1"><a class="reference internal" href="namespacelist.html">Namespace list</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nyx</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Hydrodynamic Equations in Comoving Coordinates</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/NyxEquations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="hydrodynamic-equations-in-comoving-coordinates">
<h1>Hydrodynamic Equations in Comoving Coordinates<a class="headerlink" href="#hydrodynamic-equations-in-comoving-coordinates" title="Permalink to this headline">¶</a></h1>
<div class="section" id="conservative-form">
<h2>Conservative Form<a class="headerlink" href="#conservative-form" title="Permalink to this headline">¶</a></h2>
<p>We solve the equations of gas dynamics in a coordinate system that is comoving
with the expanding universe, with expansion factor, <span class="math notranslate nohighlight">\(a,\)</span> related to the redshift, <span class="math notranslate nohighlight">\(z\)</span>, by <span class="math notranslate nohighlight">\(a = 1 / (1 + z).\)</span>
The continuity equation is written,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\label{eq:dens}
\frac{\partial \rho_b}{\partial t} = - \frac{1}{a} \nabla \cdot (\rho_b {\bf U})  , \\\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho_b\)</span> is the comoving baryonic density, related to the proper density by <span class="math notranslate nohighlight">\(\rho_b = a^3 \rho_{proper},\)</span>
and <span class="math notranslate nohighlight">\({\bf U}\)</span> is the proper peculiar baryonic velocity.</p>
<p>The momentum evolution equation can be expressed as</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{\partial (\rho_b {\bf U})}{\partial t} &amp;=&amp;  \frac{1}{a} \left(
- \nabla \cdot (\rho_b {\bf U} {\bf U})
- \nabla p
+ \rho_b {\bf g}
+ {\bf S}_{\rho {\bf U}}
- \dot{a} \rho_b {\bf U} \right)  , \end{aligned}\]</div>
<p>or equivalently,</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\label{eq:momt}
\frac{\partial (a \rho_b {\bf U})}{\partial t} &amp;=&amp;
-             \nabla \cdot (\rho_b {\bf U} {\bf U})
-             \nabla p
+             \rho_b {\bf g}
+             {\bf S}_{\rho {\bf U}}  , \end{aligned}\]</div>
<p>where the pressure, <span class="math notranslate nohighlight">\(p\)</span>, that appears in the
evolution equations is related to the proper pressure, <span class="math notranslate nohighlight">\(p_{proper},\)</span> by <span class="math notranslate nohighlight">\(p = a^3 p_{proper}.\)</span>
Here <span class="math notranslate nohighlight">\({\bf g} = - \nabla \phi\)</span> is the gravitational acceleration vector, and
<span class="math notranslate nohighlight">\({\bf S}_{\rho {\bf U}}\)</span> represents any external forcing terms.</p>
<p>The energy equation can be written,</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{\partial (\rho_b E)}{\partial t} &amp;=&amp; \frac{1}{a} \left[
- \nabla \cdot (\rho_b {\bf U} E + p {\bf U})
+ ( \rho_b {\bf U} \cdot {\bf g} +  S_{\rho E} )
- \dot{a} ( 3 (\gamma - 1) \rho_b e + \rho_b ( {\bf U} \cdot {\bf U}) ) \right]  . \end{aligned}\]</div>
<p>or equivalently,</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\label{eq:energy}
\frac{\partial (a^2 \rho_b E)}{\partial t} &amp;=&amp; a \left[
- \nabla \cdot (\rho_b {\bf U} E + p {\bf U})
+  \rho_b {\bf U} \cdot {\bf g}
+  S_{\rho E}
+  \dot{a} ( \; ( 2 - 3 (\gamma - 1) ) \; \rho_b e ) \right]  . \end{aligned}\]</div>
<p>Here <span class="math notranslate nohighlight">\(E = e + {\bf U} \cdot {\bf U} / 2\)</span> is the total energy per unit mass,
where <span class="math notranslate nohighlight">\(e\)</span> is the specific internal energy.
<span class="math notranslate nohighlight">\(S_{\rho E} = S_{\rho e} + {\bf U} \cdot {\bf S}_{\rho {\bf U}}\)</span>
where <span class="math notranslate nohighlight">\(S_{\rho e} = \Lambda^H - \Lambda^C\)</span> represents the heating and cooling terms, respectively.
We can write the evolution equation for internal energy as</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{\partial (\rho_b e)}{\partial t} &amp;=&amp; \frac{1}{a} \left[
- \nabla \cdot (\rho_b {\bf U} e)
- p \nabla \cdot {\bf U}
- \dot{a} ( 3 (\gamma - 1) \rho_b e )
+ S_{\rho e}  \right]  . \end{aligned}\]</div>
<p>or equivalently,</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{\partial (a^2 \rho_b e)}{\partial t} &amp;=&amp;  a \left[
- \nabla \cdot (\rho_b {\bf U} e)
- p \nabla \cdot {\bf U}
+ S_{\rho e}
+ \dot{a} ( \; ( 2 - 3 (\gamma - 1) ) \; \rho_b e ) \right]  . \end{aligned}\]</div>
<p>Note that for a gamma-law gas with <span class="math notranslate nohighlight">\(\gamma = 5/3,\)</span> we can write</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{\partial (a^2 \rho_b E)}{\partial t} &amp;=&amp;  a \left[
 -\nabla \cdot (\rho_b {\bf U} E + p {\bf U})
+  \rho_b {\bf U} \cdot {\bf g}
+  S_{\rho e}  \right]   . \end{aligned}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{\partial (a^2 \rho_b e)}{\partial t} &amp;=&amp; a \left[
- \nabla \cdot (\rho_b {\bf U} e)
-  p \nabla \cdot {\bf U}
+  S_{\rho e}  \right]   . \end{aligned}\]</div>
</div>
<div class="section" id="tracing">
<h2>Tracing<a class="headerlink" href="#tracing" title="Permalink to this headline">¶</a></h2>
<p>In order to compute the fluxes on faces, we trace <span class="math notranslate nohighlight">\(\rho, {\bf U}, \rho e\)</span> and <span class="math notranslate nohighlight">\(p\)</span> to the faces.</p>
<p>Thus we must convert the momentum evolution equation into a velocity evolution equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{\partial{\bf U}}{\partial t} &amp;=&amp;  \frac{1}{\rho_b} \left(
\frac{\partial (\rho_b {\bf U})}{\partial t}  - {\bf U} \frac{\partial \rho_b}{\partial t}  \right) \\
&amp;=&amp;  \frac{1}{a \rho_b} \left(
- \nabla \cdot (\rho_b {\bf U} {\bf U})
- \nabla p
+ \rho_b {\bf g}
+ S_{\rho {\bf U}}
- \dot{a} \rho_b {\bf U} \right)
+ \frac{1}{a}  {\bf U} \; \nabla \cdot (\rho_b {\bf U}) \\
&amp;=&amp;  \frac{1}{a} \left(
- {\bf U} \cdot \nabla {\bf U}
- \frac{1}{\rho_b} \nabla p
+ {\bf g}
+ \frac{1}{\rho_b} {\bf S}_{\rho {\bf U}}
- \dot{a} {\bf U} \right)  .\end{aligned}\end{split}\]</div>
<div class="section" id="subgrid-scale-model-in-comoving-coordinates">
<h3>Subgrid Scale Model in Comoving Coordinates<a class="headerlink" href="#subgrid-scale-model-in-comoving-coordinates" title="Permalink to this headline">¶</a></h3>
<p>The fundamental modification to the standard compressible equations is the addition
of a SGS turbulence energy variable, <span class="math notranslate nohighlight">\(K\)</span> and associated source terms in the equations
for the evolution of velocity, total energy, and <span class="math notranslate nohighlight">\(K\)</span> <a href="#id1"><span class="problematic" id="id2">:raw-latex:`\cite{schumann:1975,sagaut,schmidt:2006}`</span></a>.
The set of conservation equations in comoving coordinates&nbsp;(<a class="reference external" href="#eq:dens">[eq:dens]</a>)–(<a class="reference external" href="#eq:energy">[eq:energy]</a>) then becomes
<a href="#id3"><span class="problematic" id="id4">:raw-latex:`\cite{maier:2009}`</span></a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{\partial \rho_b}{\partial t} =&amp; - \frac{1}{a} \nabla \cdot (\rho_b {\bf U})  , \\
\label{eq:momt_les}
\frac{\partial (a \rho_b {\bf U})}{\partial t} =&amp;
-             \nabla \cdot (\rho_b {\bf U} {\bf U})
-             \nabla p
+             \nabla \cdot \boldsymbol{\tau}
+             \rho_b {\bf g}   , \\
\label{eq:energy_les}
\frac{\partial (a^2 \rho_b E)}{\partial t} =&amp; - a \nabla \cdot (\rho_b {\bf U} E + p {\bf U})
+  a \rho_b {\bf U} \cdot {\bf g}
+ a \nabla \cdot ({\bf U}\cdot\boldsymbol{\tau}) - a^2(\Sigma - \rho_b \varepsilon)  \\
\nonumber
&amp;+ a \dot{a} \left( ( 2 - 3 (\gamma - 1) ) \rho_b e \right)
+ a^2 ( \Lambda^H  - \Lambda^C )   , \\
\label{eq:k_les}
\frac{\partial (a^2\rho_b K)}{\partial t} =&amp;
- a\nabla \cdot \left(\rho_b {\bf U} K\right)
+ a\nabla \cdot \left(\rho_b \kappa_{\rm sgs}\nabla K\right)
+ a^2(\Sigma - \rho_b \varepsilon) .\end{aligned}\end{split}\]</div>
<p>The interaction between resolved and unresolved turbulent eddies is described by
the SGS turbulence stress tensor <span class="math notranslate nohighlight">\(\boldsymbol{\tau}\)</span>. Since inertial-range dynamics of
turbulence is scale-invariant, we conjecture that <span class="math notranslate nohighlight">\(\boldsymbol{\tau}\)</span> in comoving coordinates
has the same form as for non-expanding fluids. For compressible turbulence,
the following closure is proposed in <a href="#id5"><span class="problematic" id="id6">:raw-latex:`\cite{schmidt:2011}`</span></a>:</p>
<div class="math notranslate nohighlight">
\[\label{eq:tau_nonlin}
  \tau_{ij}= 2C_{1}\Delta\rho_b(2 K_{\mathrm{sgs}})^{1/2}S_{\! ij}^{\ast}
  -4C_{2}\rho_bK\frac{U_{i,k}U_{j,k}}{|\nabla{\bf U}|^{2}}
  -\frac{2}{3}(1-C_{2})\rho_bK\delta_{ij}.\]</div>
<p>where <span class="math notranslate nohighlight">\(|\nabla{\bf U}|:=(2U_{i,k}U_{i,k})^{1/2}\)</span> is the norm of the resolved velocity derivative,</p>
<div class="math notranslate nohighlight">
\[S_{ij}^{\ast} = S_{ij} - \frac{1}{3}\delta_{ij}d =
\frac{1}{2} (U_{i,j} + U_{j,i}) - \frac{1}{3}\delta_{ij}U_{k,k}\]</div>
<p>is the trace-free rate-of strain, and <span class="math notranslate nohighlight">\(\Delta=(\vartriangle\!x\,\vartriangle\!y\,\vartriangle\!z)^{1/3}\)</span>
is the grid scale in comoving coordinates. The production and dissipation terms in equation&nbsp;(<a class="reference external" href="#eq:k_les">[eq:k_les]</a>)
are defined as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\Sigma             &amp;=&amp; \frac{1}{a}\tau_{ij} S_{ij}, \\
\varepsilon &amp;=&amp; \frac{C_\varepsilon K^{3/2}}{a\Delta},\end{aligned}\end{split}\]</div>
<p>and <span class="math notranslate nohighlight">\(\kappa_{\rm sgs} = C_{\kappa}\Delta K^{1/2}\)</span> is the SGS diffusivity.
Here we assume that the Reynolds number of turbulence is high such that the damping of turbulent eddies by the microscopic
viscosity of the fluid occurs entirely on the subgrid scales. Because of the numerical viscosity of PPM,
however, part of the numerically resolved kinetic energy will be dissipated directly into internal energy.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Particles.html" class="btn btn-neutral float-right" title="Dark matter particles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="NyxGravity.html" class="btn btn-neutral float-left" title="Gravity" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Nyx development team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>