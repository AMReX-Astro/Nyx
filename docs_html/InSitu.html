

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>In situ Analysis &mdash; Nyx  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Analyzing Outputs" href="PostProcessing.html" />
    <link rel="prev" title="Dark matter particles" href="Particles.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Nyx
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Nyx basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="NyxPreface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxCitation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxGettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxUnits.html">Units and Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxInputs.html">Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ICs.html">Initial conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Refinement.html">Refinement Criteria</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxGravity.html">Gravity</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxEquations.html">Hydrodynamic Equations in Comoving Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxSplitting.html">Hydrodynamical and Heating-Cooling Splitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxHeatCool.html">Radiative Heating and Cooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxForcing.html">Stochastic Forcing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Dark matter particles</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">In situ Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ascent-visualization">Ascent visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sensei-interface">Sensei interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#halo-finding">Halo finding</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PostProcessing.html">Analyzing Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="NightlyTests.html">Nightly Regression Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Development.html">Work in Progress</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nyx</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>In situ Analysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/InSitu.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="in-situ-analysis">
<span id="insitu"></span><h1>In situ Analysis<a class="headerlink" href="#in-situ-analysis" title="Permalink to this headline">¶</a></h1>
<p>Nyx supports in situ visualization using Ascent, and can leverage AMReX’s Sensei visualization pipeline. Additionally, Nyx supports in situ halo finding using Reeber2. This is useful both as
in situ analysis tool, and for subgrid models, like AGN (under development).</p>
<p>These insitu calls are controlled by input flags, in this example analysis happens starting after step 100, for step 199, 299, and so on and so forth:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">insitu</span><span class="o">.</span><span class="n">int</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">insitu</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>Additionally, we can request analysis at specific redshifts, and Nyx will adjust the time-stepping to reach those red-shifts exactly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nyx</span><span class="o">.</span><span class="n">analysis_z_values</span> <span class="o">=</span> <span class="mf">7.0</span> <span class="mf">6.0</span> <span class="mf">5.0</span> <span class="mf">4.0</span> <span class="mf">3.0</span> <span class="mf">2.0</span>
</pre></div>
</div>
<div class="section" id="ascent-visualization">
<h2>Ascent visualization<a class="headerlink" href="#ascent-visualization" title="Permalink to this headline">¶</a></h2>
<p>The primary example of this functionality is in <cite>Nyx/Exec/LyA</cite>. To compile with Ascent, add in GNUmakefile.summit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USE_ASCENT_INSITU</span> <span class="o">=</span> <span class="n">TRUE</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code> file will determine while the code is running what the Ascent publish action does. The <code class="docutils literal notranslate"><span class="pre">ascent_actions_slicefile.yaml</span></code> file gives an example of saving slice data, rather than an image file, while the simulation is running.</p>
<p>To build Ascent with Conduit for other machines and configurations, see <a class="reference external" href="https://ascent.readthedocs.io/en/latest/BuildingAscent.html">Building Ascent</a>. For further information about using Ascent with AMReX-based applications, see <a class="reference external" href="https://amrex-codes.github.io/amrex/tutorials_html/Blueprint_Tutorial.html">AMReX Blueprint Tutorial</a> and <a class="reference external" href="https://warpx.readthedocs.io/en/latest/visualization/ascent.html">WarpX Ascent InSitu Documentation</a>.</p>
</div>
<div class="section" id="sensei-interface">
<h2>Sensei interface<a class="headerlink" href="#sensei-interface" title="Permalink to this headline">¶</a></h2>
<p>See AMReX documentation: <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/Visualization.html#sensei">SENSEI</a></p>
</div>
<div class="section" id="halo-finding">
<h2>Halo finding<a class="headerlink" href="#halo-finding" title="Permalink to this headline">¶</a></h2>
<p>To find halos in situ while Nyx is running we use the Reeber package.
To compile with Reeber, add in GNUmakefile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">REEBER</span> <span class="o">=</span> <span class="n">TRUE</span>
</pre></div>
</div>
<p>and set the location of Boost library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>BOOST_INLUDE_DIR := ${BOOST_ROOT}/include/boost
</pre></div>
</div>
<p>GNUmake will default to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>DIY_INCLUDE_DIR ?= ../../../diy/include
REEBER_EXT_HOME ?= ../../../Reeber2
</pre></div>
</div>
<p>Note that these codes are in separate repositories and are not included in Nyx distribution.
If you intend to use in situ halo finding, you should clone Reeber from its
<a class="reference external" href="https://github.com/mrzv/reeber">GitHub page</a> and follow the installation instructions provided there.</p>
<p>In the Nyx inputs file, one should specify the time step interval for halo finder, fields which will be
used (to use the total density, one should specify both (gas) <code class="docutils literal notranslate"><span class="pre">density</span></code> and <code class="docutils literal notranslate"><span class="pre">particle_mass_density</span></code>),
and thresholds of the boundary and extrema values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Halo Finder</span>
<span class="n">reeber</span><span class="o">.</span><span class="n">halo_int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">reeber</span><span class="o">.</span><span class="n">negate</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">reeber</span><span class="o">.</span><span class="n">halo_density_vars</span> <span class="o">=</span> <span class="n">density</span> <span class="n">particle_mass_density</span>
<span class="n">reeber</span><span class="o">.</span><span class="n">halo_extrema_threshold</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">reeber</span><span class="o">.</span><span class="n">halo_component_threshold</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Call reeber insitu analysis</span>
<span class="n">insitu</span><span class="o">.</span><span class="n">reeber_int</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="PostProcessing.html" class="btn btn-neutral float-right" title="Analyzing Outputs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Particles.html" class="btn btn-neutral float-left" title="Dark matter particles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Nyx development team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>