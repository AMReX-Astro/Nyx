<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grid Creation &mdash; Nyx  documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Load Balancing" href="LoadBalancing.html" />
    <link rel="prev" title="Gridding and Load Balancing" href="ManagingGridHierarchy_Chapter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Nyx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Nyx basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="NyxPreface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxCitation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxGettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxUnits.html">Units and Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxInputs.html">Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ICs.html">Initial conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Refinement.html">Refinement Criteria</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Grid Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="LoadBalancing.html">Load Balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="LoadBalancing.html#load-balancing-the-hydrodynamical-mesh">Load Balancing the Hydrodynamical Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="LoadBalancing.html#load-balancing-the-dark-matter-particles">Load Balancing the Dark Matter Particles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="NyxGravity.html">Gravity</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxEquations.html">Hydrodynamic Equations in Comoving Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxSplitting.html">Hydrodynamical and Heating-Cooling Splitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxHeatCool.html">Radiative Heating and Cooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="NyxForcing.html">Stochastic Forcing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles.html">Dark matter particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="InSitu.html">In situ Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="PostProcessing.html">Analyzing Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="NightlyTests.html">Nightly Regression Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Development.html">Work in Progress</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nyx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a> &raquo;</li>
      <li>Grid Creation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/GridCreation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="grid-creation">
<span id="sec-grid-creation"></span><h1>Grid Creation<a class="headerlink" href="#grid-creation" title="Permalink to this headline">¶</a></h1>
<p>To run Nyx you must specify <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">n_cell</span></span></code> in the inputs file –
this is the number of cells spanning the domain in each coordinate direction at level 0.</p>
<p>Users often specify <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> as well. The default load balancing algorithm then divides the
domain in every direction so that each grid is no longer than <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> in that direction.
If not specified by the user, <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> defaults to 128 in 2D and 32 in 3D (in each coordinate direction).</p>
<p>Another popular input is <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code>.  The value of <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code>
constrains grid creation in that in that each grid must be divisible by <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code>.
Note that both the domain (at each level) and <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> must be divisible by <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code>
If not specified by the user, <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code> defaults to 8 in each coordinate direction.
The typical purpose of <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code> is to ensure that the grids will be
sufficiently coarsenable for good multigrid performance.</p>
<p>There is one more default behavior to be aware of.  There is a boolean <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">refine_grid_layout</span></span></code>
that defaults to true but can be over-ridden at run-time.
If <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">refine_grid_layout</span></span></code> is true and the number of grids created is less than the number of processors
(Ngrids &lt; Nprocs), then grids will be further subdivided until Ngrids &gt;= Nprocs.</p>
<p>Caveat: if subdividing the grids to achieve Ngrids &gt;= Nprocs would violate the
<code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code> criterion then additional grids are not created and the
number of grids will remain less than the number of processors</p>
<p>Note that <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">n_cell</span></span></code> must be given as three separate integers, one for each coordinate direction.</p>
<p>However, <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> and <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code> can be specified as a single value
applying to all coordinate directions, or as separate values for each direction.</p>
<blockquote>
<div><ul class="simple">
<li>if <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> (or <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code>) is specified as multiple integers then the first
integer applies to level 0, the second to level 1, etc.  If you don’t specify as many
integers as there are levels, the final value will be used for the remaining levels.</li>
<li>if different values of <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> (or <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code>) are wanted for each coordinate direction,
then <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size_x</span></span></code>, <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size_y</span></span></code> and <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size_z</span></span></code>
(or <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor_x</span></span></code>, <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor_y</span></span></code> and <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor_z</span></span></code>) must be used.
If you don’t specify as many integers as there are levels, the final value will be used for the remaining levels.</li>
<li>note that <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> is just an upper bound; with <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">n_cell</span></span><span class="whitespace"> </span><span class="operator"><span class="pre">=</span></span><span class="whitespace"> </span><span class="literal number integer"><span class="pre">48</span></span></code>
and <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span><span class="whitespace"> </span><span class="operator"><span class="pre">=</span></span><span class="whitespace"> </span><span class="literal number integer"><span class="pre">32</span></span></code>, we will typically have one grid of length 32 and one of length 16.</li>
</ul>
</div></blockquote>
<p>The grid creation process at level 0 proceeds as follows (if not using the KD-tree approach):</p>
<ol class="arabic simple">
<li>The domain is initially defined by a single grid of size <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">n_cell</span></span></code>.</li>
<li>If <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">n_cell</span></span></code> is greater than <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> then the grids are subdivided until
each grid is no longer than  <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">max_grid_size</span></span></code> cells on each side.  The <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code> criterion
(ie that the length of each side of each grid is divisible by <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code> in that direction)
is satisfied during this process.</li>
<li>Next, if <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">refine_grid_layout</span></span><span class="whitespace"> </span><span class="operator"><span class="pre">=</span></span><span class="whitespace"> </span><span class="name builtin"><span class="pre">true</span></span></code> and there are more processors than grids
at this level, then the grids at this level are further divided until Ngrids &gt;= Nprocs
(unless doing so would violate the <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">blocking_factor</span></span></code> criterion).</li>
</ol>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ManagingGridHierarchy_Chapter.html" class="btn btn-neutral float-left" title="Gridding and Load Balancing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="LoadBalancing.html" class="btn btn-neutral float-right" title="Load Balancing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Nyx development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>